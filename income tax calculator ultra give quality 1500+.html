<meta name='viewport' content='width=device-width, initial-scale=1'/>```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Next-Level Indian Income Tax Calculator | Futuristic Dark Theme</title>
    <meta name="description" content="Calculate your Indian income tax liability under both old and new regimes with advanced features, stunning visuals, smart suggestions, and downloadable reports.">

    <!-- Favicon (Optional - Replace with your own) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ðŸ’°</text></svg>">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Embedded CSS -->
    <style>
        /* ------------------------- */
        /* --- RESET & BASE STYLES --- */
        /* ------------------------- */
        :root {
            --bg-primary: #0F0F1A; /* Deep space blue/purple */
            --bg-secondary: #1A1A2E; /* Slightly lighter dark blue */
            --bg-glass: rgba(26, 26, 46, 0.6); /* Semi-transparent for glass effect */
            --accent-primary: #00CFFF; /* Bright cyan */
            --accent-secondary: #A855F7; /* Purple */
            --text-primary: #E0E0E0; /* Light grey */
            --text-secondary: #A0A0B0; /* Mid grey */
            --text-dark: #1A1A2E;
            --glow-color: rgba(0, 207, 255, 0.4); /* Cyan glow */
            --border-color: rgba(255, 255, 255, 0.1);
            --success-color: #2ECC71;
            --warning-color: #F39C12;
            --error-color: #E74C3C;

            --font-primary: 'Poppins', sans-serif;
            --font-display: 'Orbitron', sans-serif; /* Futuristic display font */

            --border-radius-sm: 4px;
            --border-radius-md: 8px;
            --border-radius-lg: 16px;

            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.2);
            --shadow-md: 0 4px 10px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
            font-size: 16px; /* Base font size */
        }

        body {
            font-family: var(--font-primary);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden; /* Prevent horizontal scroll */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        main {
          flex-grow: 1;
        }

        /* Accessibility: Improve focus visibility */
        *:focus-visible {
            outline: 2px solid var(--accent-primary);
            outline-offset: 2px;
            box-shadow: 0 0 0 4px var(--glow-color);
        }

        /* Remove default list styles */
        ul, ol {
            list-style: none;
        }

        a {
            color: var(--accent-primary);
            text-decoration: none;
            transition: color 0.3s ease;
        }
        a:hover {
            color: var(--accent-secondary);
            text-decoration: underline;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: var(--font-display);
            margin-bottom: 1rem;
            line-height: 1.2;
            color: var(--accent-primary);
            text-shadow: 0 0 5px var(--glow-color);
            letter-spacing: 1px;
        }

        h1 { font-size: 2.8rem; }
        h2 { font-size: 2.2rem; margin-top: 2.5rem; }
        h3 { font-size: 1.6rem; color: var(--text-primary); text-shadow: none; font-family: var(--font-primary); font-weight: 600; }
        h4 { font-size: 1.3rem; color: var(--text-secondary); font-family: var(--font-primary); font-weight: 500; }


        /* Utility Classes */
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 0;
        }

        .text-center { text-align: center; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mt-4 { margin-top: 2rem; }


        /* ------------------------- */
        /* ------- LOADER ---------- */
        /* ------------------------- */
        #loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: var(--bg-primary);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        #loader-icon { /* Example: Pulsing Atom */
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid transparent;
            border-top-color: var(--accent-primary);
            border-bottom-color: var(--accent-secondary);
            animation: spin 1.5s linear infinite;
            position: relative;
        }
        #loader-icon::before {
            content: '';
            position: absolute;
            top: 5px; left: 5px; right: 5px; bottom: 5px;
            border-radius: 50%;
            border: 3px solid transparent;
            border-top-color: var(--accent-secondary);
            border-bottom-color: var(--accent-primary);
            animation: spin 2s linear infinite reverse;
        }
        #loader-text {
          font-family: var(--font-display);
          margin-top: 1.5rem;
          color: var(--text-secondary);
          font-size: 1.2rem;
          letter-spacing: 2px;
          animation: pulseText 2s ease-in-out infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
         @keyframes pulseText {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; text-shadow: 0 0 8px var(--glow-color); }
        }

        /* ------------------------- */
        /* ----- HEADER STYLES ----- */
        /* ------------------------- */
        header {
            background: linear-gradient(to bottom, rgba(26, 26, 46, 0.9), rgba(15, 15, 26, 0.8));
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-md);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            animation: slideDown 0.8s ease-out; /* Animation #1 */
        }
        header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0; /* Reduced padding inside container */
        }

        .logo {
            display: flex;
            align-items: center;
            font-family: var(--font-display);
            font-size: 1.8rem;
            font-weight: 700;
            color: #fff;
            text-shadow: 0 0 10px var(--glow-color);
            animation: logoGlow 3s infinite alternate ease-in-out; /* Animation #2 */
        }

        .logo i {
            margin-right: 0.7rem;
            font-size: 2rem;
            color: var(--accent-primary);
            animation: iconSpin 5s linear infinite; /* Animation #3 */
        }

        @keyframes slideDown {
           from { transform: translateY(-100%); opacity: 0; }
           to { transform: translateY(0); opacity: 1; }
        }

        @keyframes logoGlow {
            from { text-shadow: 0 0 5px var(--glow-color), 0 0 10px var(--glow-color); }
            to { text-shadow: 0 0 15px var(--glow-color), 0 0 25px var(--glow-color); }
        }
        @keyframes iconSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }


        /* ------------------------- */
        /* ------ FORM STYLES ------ */
        /* ------------------------- */
        .input-section, .results-section, .visual-guides-section {
            background: var(--bg-secondary);
            border-radius: var(--border-radius-lg);
            padding: 2rem 2.5rem;
            margin-bottom: 2.5rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            /* Initial animation state */
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out; /* Base transition for scroll/load */
        }
         /* Add class for visible state */
        .input-section.is-visible,
        .results-section.is-visible,
        .visual-guides-section.is-visible {
             opacity: 1;
             transform: translateY(0);
         }

        #tax-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.8rem;
        }

        .form-group {
            position: relative;
            display: flex;
            flex-direction: column;
            animation: fadeInUp 0.5s ease-out forwards; /* Animation #4 */
            opacity: 0; /* Start hidden for stagger */
        }

        .form-group label {
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
        }
         .form-group label i {
            margin-right: 8px;
            color: var(--accent-secondary);
            width: 16px;
            text-align: center;
         }
        .info-icon {
            margin-left: 8px;
            color: var(--accent-primary);
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .info-icon:hover {
           transform: scale(1.2);
           color: var(--accent-secondary);
        }


        .input-wrapper {
            position: relative;
        }

        .input-prefix {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-weight: 600;
        }

        input[type="number"], select {
            width: 100%;
            padding: 0.8rem 1rem;
            background-color: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
            color: var(--text-primary);
            font-size: 1rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            font-family: var(--font-primary);
        }
         input[type="number"].has-prefix {
             padding-left: 35px;
         }

        input[type="number"]:focus, select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px var(--glow-color);
        }

        /* Remove spinners for number input */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
          -webkit-appearance: none;
          margin: 0;
        }
        input[type=number] {
          -moz-appearance: textfield; /* Firefox */
        }

        select {
             appearance: none;
             background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23A0A0B0' viewBox='0 0 24 24' width='24' height='24'%3E%3Cpath d='M7 10l5 5 5-5H7z'/%3E%3C/svg%3E");
             background-repeat: no-repeat;
             background-position: right 1rem center;
             background-size: 1em;
             padding-right: 2.5rem; /* Make space for arrow */
        }

        /* Neumorphism/Glassmorphism Switch (Choose One or mix elements) */
        /* Example: Neumorphism Button */
        .neumorphism-button {
             background: var(--bg-secondary);
             border: none;
             border-radius: 10px;
             padding: 1rem 2rem;
             font-size: 1.1rem;
             font-weight: 600;
             color: var(--accent-primary);
             font-family: var(--font-display);
             cursor: pointer;
             box-shadow: 5px 5px 10px #121220, -5px -5px 10px #22223c;
             transition: all 0.2s ease-in-out;
             text-shadow: 0 0 3px var(--glow-color);
             letter-spacing: 1px;
         }
         .neumorphism-button:hover {
             box-shadow: 3px 3px 6px #121220, -3px -3px 6px #22223c;
             color: var(--accent-secondary);
         }
        .neumorphism-button:active {
             box-shadow: inset 3px 3px 6px #121220, inset -3px -3px 6px #22223c;
             color: var(--text-primary);
         }


        /* Example: Glassmorphism Card */
        .glassmorphism-card {
             background: var(--bg-glass);
             backdrop-filter: blur(8px);
             -webkit-backdrop-filter: blur(8px);
             border: 1px solid var(--border-color);
             border-radius: var(--border-radius-lg);
             padding: 1.5rem;
             box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
         }

         /* Main Calculate Button */
        #calculate-btn {
            grid-column: 1 / -1; /* Span full width */
            margin-top: 1rem;
            /* Using the neumorphism style defined above */
            padding: 1.2rem 2.5rem;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
             transition: all 0.3s ease-in-out; /* Smooth transition */
             /* Animation #5 - Pulse/Glow on idle */
             animation: pulseButton 2s infinite ease-in-out;
         }
         #calculate-btn i {
            margin-right: 10px;
            transition: transform 0.3s ease;
         }
        #calculate-btn:hover i {
            transform: rotate(360deg); /* Animation #6 on hover */
        }
        #calculate-btn:hover {
             animation-play-state: paused; /* Stop pulsing on hover */
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            color: var(--text-dark);
             box-shadow: 0 0 15px var(--glow-color), 0 0 25px rgba(168, 85, 247, 0.5); /* Hover glow */
             text-shadow: none;
        }

         @keyframes pulseButton {
           0% { transform: scale(1); box-shadow: 5px 5px 10px #121220, -5px -5px 10px #22223c, 0 0 5px var(--glow-color); }
           50% { transform: scale(1.03); box-shadow: 7px 7px 14px #121220, -7px -7px 14px #22223c, 0 0 15px var(--glow-color);}
           100% { transform: scale(1); box-shadow: 5px 5px 10px #121220, -5px -5px 10px #22223c, 0 0 5px var(--glow-color); }
         }
        @keyframes fadeInUp { /* For form fields */
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }


        /* Tooltip Styles */
        .tooltip {
            position: absolute;
            bottom: 105%; /* Position above the info icon */
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0,0,0,0.85);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: var(--border-radius-sm);
            font-size: 0.85rem;
            white-space: nowrap;
            z-index: 10;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
             /* Animation #7 on show */
            transform: translateX(-50%) translateY(5px); /* Start slightly down */
        }
         .tooltip::after { /* Arrow */
             content: '';
             position: absolute;
             top: 100%;
             left: 50%;
             margin-left: -5px;
             border-width: 5px;
             border-style: solid;
             border-color: rgba(0,0,0,0.85) transparent transparent transparent;
         }
        .info-icon-wrapper:hover .tooltip {
             opacity: 1;
             visibility: visible;
            /* Animation #8 on show */
             transform: translateX(-50%) translateY(0);
         }
         .info-icon-wrapper { /* Wrapper to help positioning */
            position: relative;
            display: inline-block;
             vertical-align: middle;
         }

        /* ------------------------- */
        /* --- RESULTS SECTION ----- */
        /* ------------------------- */
         #results-section {
            /* Default state handled by general section styles */
            display: none; /* Start hidden, manage visibility with JS */
            position: relative; /* For loader */
        }
         #results-loader {
             position: absolute;
             top: 0; left: 0; right: 0; bottom: 0;
             background: rgba(26, 26, 46, 0.9); /* Dark overlay */
             z-index: 50;
             display: flex;
             justify-content: center;
             align-items: center;
             flex-direction: column;
             font-size: 1.2rem;
             color: var(--accent-primary);
             opacity: 0; /* Managed by JS */
             pointer-events: none; /* Managed by JS */
             transition: opacity 0.3s ease;
         }
        #results-loader i {
             font-size: 2.5rem;
             margin-bottom: 1rem;
            /* Animation #9: Loader Icon */
             animation: gearTurn 2s linear infinite;
         }

         @keyframes gearTurn {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
         }

        .regime-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2.5rem;
            margin-bottom: 2.5rem;
        }

        .result-card {
            /* Using glassmorphism style */
            background: var(--bg-glass);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            padding: 1.8rem;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
             /* Animation #10: Card Entry */
            transform: scale(0.9);
            opacity: 0;
             animation: zoomIn 0.5s ease-out forwards;
             animation-delay: var(--animation-delay, 0s); /* Stagger animation */
        }

        @keyframes zoomIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .result-card h3 {
            color: var(--accent-primary);
            font-size: 1.4rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.8rem;
            margin-bottom: 1.2rem;
            text-align: center;
            font-family: var(--font-primary);
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 0.6rem 0;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.08);
             font-size: 0.95rem;
             /* Animation #11: Result Item Fly-in */
             opacity: 0;
             transform: translateX(-20px);
             animation: slideInLeft 0.4s ease-out forwards;
             animation-delay: calc(var(--item-index, 0) * 0.1s + 0.3s); /* Stagger item animation */
         }
        .result-item:last-child {
             border-bottom: none;
         }
         .result-item span:first-child {
             color: var(--text-secondary);
             font-weight: 500;
         }
        .result-item span:last-child {
             font-weight: 700;
             color: #fff;
             font-size: 1.05rem;
             font-family: var(--font-display); /* Use display font for numbers */
             /* Target for number count animation */
         }
         .result-item .tax-amount {
             color: var(--accent-secondary);
             font-size: 1.3rem;
             /* Animation #12: Number Counter Glow */
             text-shadow: 0 0 8px rgba(168, 85, 247, 0.7);
         }

         @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
         }

        /* Chart Containers */
        .chart-container {
            width: 100%;
            height: 250px; /* Adjust height as needed */
            margin: 1rem 0 1.5rem;
            position: relative;
            /* Animation #13: Chart Fade-in */
            opacity: 0;
             animation: fadeIn 0.8s ease-out forwards 0.5s;
        }

         #comparison-chart-container {
             width: 100%;
             max-width: 600px;
             height: 350px;
             margin: 2.5rem auto 2rem;
            /* Animation #14: Comparison Chart Entry */
             opacity: 0;
             transform: scale(0.8);
             animation: scaleUp 0.7s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards 1s;
         }

         @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
         }
         @keyframes scaleUp {
             from { opacity: 0; transform: scale(0.8); }
             to { opacity: 1; transform: scale(1); }
         }

         canvas { /* Make charts responsive */
             max-width: 100%;
             height: auto !important; /* Override inline styles set by Chart.js */
         }

        /* Monthly Breakdown Toggle */
        .monthly-toggle {
             display: block;
             margin: 1rem auto 0;
             background: none;
             border: 1px solid var(--accent-primary);
             color: var(--accent-primary);
             padding: 8px 15px;
             border-radius: var(--border-radius-md);
             cursor: pointer;
             font-size: 0.9rem;
             transition: background-color 0.3s, color 0.3s, transform 0.2s; /* Animation #15: Button Interaction */
         }
        .monthly-toggle:hover {
             background-color: var(--accent-primary);
             color: var(--bg-secondary);
            /* Animation #16: Hover Scale */
             transform: scale(1.05);
         }
         .monthly-breakdown {
             max-height: 0;
             overflow: hidden;
             transition: max-height 0.5s ease-in-out, margin-top 0.5s ease-in-out; /* Animation #17: Accordion */
             margin-top: 0;
         }
        .monthly-breakdown.visible {
             max-height: 300px; /* Adjust as needed */
             margin-top: 1rem;
         }
        .monthly-breakdown p {
            font-size: 0.9rem;
            padding: 4px 0;
             display: flex;
             justify-content: space-between;
         }
         .monthly-breakdown span:last-child { font-weight: 600; }

        /* ------------------------- */
        /* TAX SAVING SUGGESTIONS -- */
        /* ------------------------- */
        #suggestions-section {
            /* Using glassmorphism card */
            background: var(--bg-glass);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            padding: 1.8rem;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            margin-top: 2.5rem;
            /* Animation #18: Section Entrance */
             opacity: 0;
             transform: translateY(50px);
             transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        #suggestions-section.is-visible {
             opacity: 1;
             transform: translateY(0);
        }
        #suggestions-section h3 {
            color: var(--accent-secondary);
            font-family: var(--font-primary);
             display: flex;
             align-items: center;
             justify-content: center;
             margin-bottom: 1.5rem;
        }
         #suggestions-section h3 i {
             margin-right: 10px;
             font-size: 1.8rem;
            /* Animation #19: Icon Pulse */
            animation: pulseIcon 2s infinite ease-in-out;
         }

         @keyframes pulseIcon {
             0%, 100% { transform: scale(1); }
             50% { transform: scale(1.1); }
         }


        #suggestion-list {
            display: grid;
             grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
             gap: 1rem;
        }

        .suggestion-item {
             background: var(--bg-primary);
             border: 1px solid var(--border-color);
             padding: 1rem 1.2rem;
             border-radius: var(--border-radius-md);
             display: flex;
             align-items: center;
             gap: 1rem;
             transition: transform 0.3s ease, box-shadow 0.3s ease; /* Animation #20: Hover Effect */
              opacity: 0; /* Start hidden */
              transform: scale(0.95) translateY(10px);
             /* Animation #21: Suggestion Item Appear */
             animation: popIn 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards;
             animation-delay: calc(var(--suggestion-index, 0) * 0.15s + 0.2s); /* Stagger */
         }
        .suggestion-item:hover {
             transform: translateY(-5px);
             box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3), 0 0 10px var(--glow-color);
         }

         .suggestion-icon {
             font-size: 1.8rem;
             min-width: 30px;
             text-align: center;
             color: var(--accent-primary);
            /* Animation #22: Icon Wiggle */
             animation: wiggle 3s infinite ease-in-out;
             animation-delay: calc(var(--suggestion-index, 0) * 0.2s);
         }
         .suggestion-text p { font-size: 0.95rem; }
         .suggestion-text strong { color: var(--accent-secondary); font-weight: 600; }

         @keyframes popIn {
           from { opacity: 0; transform: scale(0.95) translateY(10px); }
           to { opacity: 1; transform: scale(1) translateY(0); }
         }
         @keyframes wiggle {
             0%, 100% { transform: rotate(-3deg); }
             50% { transform: rotate(3deg); }
         }

        /* ------------------------- */
        /* -- PDF DOWNLOAD BUTTON -- */
        /* ------------------------- */
        #download-pdf-btn {
             display: block;
             width: fit-content;
             margin: 2.5rem auto 0;
            /* Reuse neumorphism or create a unique style */
             background: var(--bg-secondary);
             border: none;
             border-radius: 10px;
             padding: 1rem 2rem;
             font-size: 1.1rem;
             font-weight: 600;
             color: var(--accent-secondary);
             font-family: var(--font-display);
             cursor: pointer;
             box-shadow: 5px 5px 10px #121220, -5px -5px 10px #22223c;
             transition: all 0.2s ease-in-out;
             letter-spacing: 1px;
              /* Animation #23: Button idle subtle move */
             animation: slightMove 5s infinite alternate ease-in-out;
         }
        #download-pdf-btn:hover {
             box-shadow: 3px 3px 6px #121220, -3px -3px 6px #22223c;
             color: var(--accent-primary);
              transform: scale(1.02) translateY(-2px); /* Animation #24: Hover Pop */
         }
        #download-pdf-btn:active {
             box-shadow: inset 3px 3px 6px #121220, inset -3px -3px 6px #22223c;
              transform: scale(0.98); /* Animation #25: Press Effect */
         }
        #download-pdf-btn i {
             margin-right: 10px;
            /* Animation #26: Icon animation on button interaction */
             transition: transform 0.3s ease-in-out;
         }
        #download-pdf-btn:hover i {
            transform: translateY(-3px);
        }
        @keyframes slightMove {
          from { transform: translateX(-2px); }
          to { transform: translateX(2px); }
        }

        /* PDF Content specific styling (applied during PDF generation) */
        .pdf-content {
          background-color: var(--bg-primary) !important;
          color: var(--text-primary) !important;
          padding: 30px; /* Add padding for the PDF */
        }
        .pdf-content h2, .pdf-content h3 {
          color: var(--accent-primary) !important; /* Ensure headings are visible */
          text-shadow: none !important; /* Simplify for PDF */
        }
        .pdf-content .result-card {
          background: var(--bg-secondary) !important; /* Ensure card background */
          border: 1px solid var(--border-color) !important;
          box-shadow: none !important; /* Simplify for PDF */
          backdrop-filter: none !important;
        }
        .pdf-content .result-item span:first-child { color: var(--text-secondary) !important; }
        .pdf-content .result-item span:last-child { color: #fff !important; }
        .pdf-content .result-item .tax-amount { color: var(--accent-secondary) !important; }


        /* ------------------------- */
        /* VISUAL GUIDES SECTION --- */
        /* ------------------------- */
        #visual-guides-section h2 {
           text-align: center;
        }
        .visual-guides-grid {
            display: grid;
             grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
             gap: 2rem;
             margin-top: 2rem;
        }
        .guide-card {
            /* Use glassmorphism */
            background: var(--bg-glass);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            padding: 1.8rem;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
             display: flex;
             flex-direction: column;
             align-items: center;
             text-align: center;
              /* Animation #27: Card Flip/Rotate on Scroll (handled by ScrollTrigger) */
             transition: transform 0.5s ease;
         }
         .guide-card-icon {
            width: 70px;
            height: 70px;
            margin-bottom: 1.5rem;
            object-fit: contain; /* For SVG/Images */
             /* Animation #28: Icon float/bob */
             animation: float 4s infinite ease-in-out;
             filter: drop-shadow(0 5px 10px rgba(0, 207, 255, 0.3));
         }

         .guide-card h3 {
            color: var(--text-primary);
             font-size: 1.3rem;
             margin-bottom: 0.8rem;
         }
         .guide-card p {
             color: var(--text-secondary);
             font-size: 0.9rem;
             line-height: 1.5;
         }
          .guide-card:hover {
             /* Animation #29: Hover Glow/Lift */
             transform: translateY(-10px) scale(1.02);
             box-shadow: 0 15px 30px rgba(0,0,0, 0.4), 0 0 20px var(--glow-color);
         }


        @keyframes float {
          0%, 100% { transform: translateY(0px); }
          50% { transform: translateY(-10px); }
        }

        /* ------------------------- */
        /* ------ FOOTER STYLES ---- */
        /* ------------------------- */
        footer {
            background-color: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            padding: 1.5rem 0;
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-secondary);
             margin-top: 3rem;
             /* Animation #30: Footer Slide Up */
             transform: translateY(100%);
             animation: slideUp 0.8s ease-out forwards 1.5s; /* Delayed animation */
        }

        footer a {
             font-weight: 500;
            /* Animation #31: Link Underline Grow */
             position: relative;
             padding-bottom: 2px;
         }
        footer a::after {
             content: '';
             position: absolute;
             bottom: 0;
             left: 0;
             width: 0;
             height: 1px;
             background-color: var(--accent-secondary);
             transition: width 0.3s ease;
         }
        footer a:hover::after {
             width: 100%;
         }


        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }


        /* ------------------------- */
        /* --- RESPONSIVENESS ------ */
        /* ------------------------- */
        @media (max-width: 992px) {
            h1 { font-size: 2.4rem; }
            h2 { font-size: 1.9rem; }

            .regime-comparison {
                grid-template-columns: 1fr; /* Stack results on smaller screens */
                gap: 2rem;
            }

            #tax-form {
                grid-template-columns: 1fr; /* Stack form groups */
            }
            #comparison-chart-container {
               max-width: 90%;
               height: 300px;
            }
        }

        @media (max-width: 768px) {
             html { font-size: 15px; }
             .container { width: 95%; }
             h1 { font-size: 2.1rem; }
             h2 { font-size: 1.7rem; }
             .logo { font-size: 1.5rem; }
             .logo i { font-size: 1.8rem; margin-right: 0.5rem; }

             .input-section, .results-section, .visual-guides-section {
                 padding: 1.5rem;
             }

             .chart-container { height: 220px; }
             #comparison-chart-container { height: 280px; }

             .visual-guides-grid { grid-template-columns: 1fr; } /* Stack guide cards */
        }

        @media (max-width: 480px) {
            html { font-size: 14px; }
             h1 { font-size: 1.8rem; }
             h2 { font-size: 1.5rem; }

             header .container { flex-direction: column; gap: 0.5rem;}
             .logo { text-align: center;}

             .neumorphism-button, #calculate-btn, #download-pdf-btn {
                 padding: 0.9rem 1.5rem;
                 font-size: 1rem;
             }
             #calculate-btn { padding: 1rem 2rem; font-size: 1.1rem; }
        }

        /* ------------------------------ */
        /* -- Additional Animation Ideas -- */
        /* ------------------------------ */
        /* Anim #32: Gradient background animation */
        /* Anim #33: Subtle background particle effect (Use JS - Three.js/particles.js - adds complexity) */
        /* Anim #34: Glowing borders on input focus */
        /* Anim #35: Smooth scrolling animation */
        /* Anim #36: Modal/Popup animations (if adding features like detailed deduction input) */

    </style>
</head>
<body>
    <!-- Page Loader -->
    <div id="loader">
        <div id="loader-icon"></div>
        <div id="loader-text">Calculating Future...</div>
    </div>

    <header>
        <div class="container">
            <a href="#" class="logo">
                <i class="fa-solid fa-calculator"></i> <!-- Placeholder icon -->
                TaxVerse AI
            </a>
            <!-- Could add navigation or theme toggle here if needed -->
        </div>
    </header>

    <main class="container">

        <!-- ====================== -->
        <!--  1. INPUT SECTION      -->
        <!-- ====================== -->
        <section class="input-section" id="input-section">
            <h2><i class="fa-solid fa-keyboard"></i> Enter Your Financial Matrix</h2>
            <form id="tax-form" novalidate>

                <!-- Assessment Year -->
                <div class="form-group">
                    <label for="assessment-year"><i class="fa-solid fa-calendar-alt"></i>Assessment Year</label>
                    <select id="assessment-year" name="assessmentYear">
                        <option value="2024-25" selected>2024-25 (FY 2023-24)</option>
                        <!-- Add other years if needed -->
                    </select>
                </div>

                 <!-- Tax Payer Type -->
                <div class="form-group">
                    <label for="tax-payer-type"><i class="fa-solid fa-user"></i>Tax Payer Type</label>
                    <select id="tax-payer-type" name="taxPayerType">
                        <option value="individual" selected>Individual</option>
                         <!-- Potentially add HUF etc. if expanding scope -->
                    </select>
                </div>

                <!-- Age Group -->
                <div class="form-group">
                    <label for="age-group"><i class="fa-solid fa-birthday-cake"></i>Age Group</label>
                    <select id="age-group" name="ageGroup">
                        <option value="below_60" selected>Below 60 years</option>
                        <option value="60_to_80">60 to 79 years (Senior Citizen)</option>
                        <option value="above_80">80 years and above (Super Senior)</option>
                    </select>
                </div>

                <!-- Residential Status (Important for some deductions/income types) -->
                <div class="form-group">
                    <label for="residential-status"><i class="fa-solid fa-house-user"></i>Residential Status</label>
                    <select id="residential-status" name="residentialStatus">
                        <option value="resident" selected>Resident</option>
                        <option value="nri">Non-Resident Indian (NRI)</option>
                        <option value="rnor">Resident but Not Ordinarily Resident (RNOR)</option>
                    </select>
                </div>

                 <!-- Basic Salary -->
                 <div class="form-group">
                    <label for="basic-salary"><i class="fa-solid fa-wallet"></i>Basic Salary (Annual)</label>
                    <div class="input-wrapper">
                        <span class="input-prefix">â‚¹</span>
                        <input type="number" id="basic-salary" name="basicSalary" class="has-prefix" placeholder="e.g., 800000" required min="0">
                    </div>
                </div>

                <!-- HRA Received -->
                 <div class="form-group">
                    <label for="hra-received"><i class="fa-solid fa-house-chimney"></i>HRA Received (Annual)
                       <span class="info-icon-wrapper">
                         <i class="fa-solid fa-circle-info info-icon"></i>
                         <span class="tooltip">Enter 0 if not received. Used for HRA deduction (Old Regime).</span>
                       </span>
                    </label>
                     <div class="input-wrapper">
                        <span class="input-prefix">â‚¹</span>
                        <input type="number" id="hra-received" name="hraReceived" class="has-prefix" placeholder="e.g., 300000" value="0" min="0">
                     </div>
                </div>

                <!-- Rent Paid -->
                 <div class="form-group">
                    <label for="rent-paid"><i class="fa-solid fa-receipt"></i>Actual Rent Paid (Annual)
                         <span class="info-icon-wrapper">
                         <i class="fa-solid fa-circle-info info-icon"></i>
                         <span class="tooltip">Enter annual rent paid if claiming HRA.</span>
                       </span>
                    </label>
                     <div class="input-wrapper">
                        <span class="input-prefix">â‚¹</span>
                        <input type="number" id="rent-paid" name="rentPaid" class="has-prefix" placeholder="e.g., 240000" value="0" min="0">
                    </div>
                </div>

                <!-- Metro City -->
                 <div class="form-group">
                    <label for="metro-city"><i class="fa-solid fa-city"></i>Live in Metro City? (for HRA)</label>
                    <select id="metro-city" name="metroCity">
                        <option value="yes">Yes (Delhi, Mumbai, Kolkata, Chennai)</option>
                        <option value="no" selected>No</option>
                    </select>
                </div>

                <!-- Other Allowances -->
                 <div class="form-group">
                    <label for="other-allowances"><i class="fa-solid fa-tags"></i>Other Allowances (Annual)
                      <span class="info-icon-wrapper">
                         <i class="fa-solid fa-circle-info info-icon"></i>
                         <span class="tooltip">Taxable allowances like Special Allowance, Bonus, etc.</span>
                       </span>
                    </label>
                     <div class="input-wrapper">
                        <span class="input-prefix">â‚¹</span>
                        <input type="number" id="other-allowances" name="otherAllowances" class="has-prefix" placeholder="e.g., 100000" value="0" min="0">
                     </div>
                </div>

                <!-- Income from Other Sources -->
                 <div class="form-group">
                    <label for="income-other-sources"><i class="fa-solid fa-piggy-bank"></i>Interest/Other Income (Annual)
                        <span class="info-icon-wrapper">
                         <i class="fa-solid fa-circle-info info-icon"></i>
                         <span class="tooltip">Like Savings Interest, FD Interest, etc.</span>
                       </span>
                    </label>
                    <div class="input-wrapper">
                        <span class="input-prefix">â‚¹</span>
                        <input type="number" id="income-other-sources" name="incomeOtherSources" class="has-prefix" placeholder="e.g., 15000" value="0" min="0">
                     </div>
                </div>

                <!-- ------------------------- -->
                <!-- ----- DEDUCTIONS --------- -->
                <!-- ------------------------- -->
                <h3 style="grid-column: 1 / -1; margin-top: 1.5rem; margin-bottom:0.5rem; border-top: 1px solid var(--border-color); padding-top: 1.5rem; font-weight: 600;">
                    <i class="fa-solid fa-shield-halved"></i> Deductions (Mostly for Old Regime)
                </h3>

                 <!-- Section 80C -->
                <div class="form-group">
                    <label for="deduction-80c"><i class="fa-solid fa-file-invoice-dollar"></i>Section 80C
                        <span class="info-icon-wrapper">
                         <i class="fa-solid fa-circle-info info-icon"></i>
                         <span class="tooltip">PPF, EPF, ELSS, LIC, Tuition Fee, etc. Max â‚¹1,50,000</span>
                       </span>
                    </label>
                     <div class="input-wrapper">
                        <span class="input-prefix">â‚¹</span>
                        <input type="number" id="deduction-80c" name="deduction80C" class="has-prefix" placeholder="Max 1,50,000" value="0" min="0" max="150000">
                     </div>
                 </div>

                 <!-- Section 80D -->
                 <div class="form-group">
                    <label for="deduction-80d"><i class="fa-solid fa-notes-medical"></i>Section 80D (Self/Family)
                      <span class="info-icon-wrapper">
                         <i class="fa-solid fa-circle-info info-icon"></i>
                         <span class="tooltip">Medical Insurance. Self/Family: 25k (or 50k if senior). Parents: Extra 25k (or 50k).</span>
                       </span>
                    </label>
                     <div class="input-wrapper">
                        <span class="input-prefix">â‚¹</span>
                        <input type="number" id="deduction-80d" name="deduction80D" class="has-prefix" placeholder="Medical Insurance Premium" value="0" min="0">
                         <!-- We will cap this dynamically in JS based on age -->
                     </div>
                </div>

                <!-- 80D for Parents -->
                 <div class="form-group">
                    <label for="deduction-80d-parents"><i class="fa-solid fa-user-doctor"></i>Section 80D (Parents)
                         <span class="info-icon-wrapper">
                         <i class="fa-solid fa-circle-info info-icon"></i>
                         <span class="tooltip">Premium for parents. Are parents Senior Citizens?</span>
                       </span>
                    </label>
                     <div class="input-wrapper" style="display:flex; align-items:center; gap: 10px;">
                        <span class="input-prefix" style="position: static; transform: none;">â‚¹</span>
                        <input type="number" id="deduction-80d-parents" name="deduction80DParents" style="flex-grow:1;" placeholder="Parents' Premium" value="0" min="0">
                        <select id="parents-senior" name="parentsSenior" style="flex-basis: 120px; padding: 0.7rem 0.5rem;">
                             <option value="no" selected>No</option>
                             <option value="yes">Yes</option>
                         </select>
                     </div>
                 </div>


                <!-- Home Loan Interest (Sec 24b) -->
                 <div class="form-group">
                    <label for="home-loan-interest"><i class="fa-solid fa-house-loan"></i>Home Loan Interest (Sec 24b)
                        <span class="info-icon-wrapper">
                         <i class="fa-solid fa-circle-info info-icon"></i>
                         <span class="tooltip">Interest paid on housing loan. Max â‚¹2,00,000 for self-occupied.</span>
                       </span>
                    </label>
                     <div class="input-wrapper">
                        <span class="input-prefix">â‚¹</span>
                        <input type="number" id="home-loan-interest" name="homeLoanInterest" class="has-prefix" placeholder="Max 2,00,000" value="0" min="0" max="200000">
                     </div>
                </div>

                <!-- Section 80TTA/TTB -->
                 <div class="form-group">
                    <label for="deduction-80tta"><i class="fa-solid fa-building-columns"></i>Interest on Savings (80TTA/TTB)
                        <span class="info-icon-wrapper">
                         <i class="fa-solid fa-circle-info info-icon"></i>
                         <span class="tooltip">Up to â‚¹10k (80TTA). Seniors up to â‚¹50k on SB/FD (80TTB). Will auto-apply limit.</span>
                       </span>
                     </label>
                     <div class="input-wrapper">
                         <span class="input-prefix">â‚¹</span>
                         <!-- Value entered here should be the actual interest received (also included in Other Income) -->
                         <input type="number" id="deduction-80tta" name="deduction80TTA" class="has-prefix" placeholder="Actual Savings Interest" value="0" min="0">
                     </div>
                </div>

                <!-- NPS 80CCD(1B) -->
                 <div class="form-group">
                    <label for="deduction-nps"><i class="fa-solid fa-umbrella-beach"></i>NPS Contribution (80CCD(1B))
                        <span class="info-icon-wrapper">
                         <i class="fa-solid fa-circle-info info-icon"></i>
                         <span class="tooltip">Additional deduction up to â‚¹50,000. (Over and above 80C).</span>
                       </span>
                    </label>
                     <div class="input-wrapper">
                        <span class="input-prefix">â‚¹</span>
                        <input type="number" id="deduction-nps" name="deductionNPS" class="has-prefix" placeholder="Max 50,000" value="0" min="0" max="50000">
                     </div>
                </div>


                <!-- Standard Deduction (Note: Auto-applied, this is just info) -->
                <div class="form-group glassmorphism-card" style="grid-column: 1 / -1; padding: 1rem; text-align: center; margin-top:1rem; background: rgba(0, 207, 255, 0.1);">
                     <h4 style="margin-bottom: 0.2rem; color: var(--accent-primary);"><i class="fa-solid fa-check-circle"></i> Standard Deduction</h4>
                    <p style="font-size: 0.9rem; color: var(--text-secondary);">
                        A standard deduction of â‚¹50,000 is automatically applied under both Old and New Regimes (for Salaried/Pensioners - FY 2023-24 onwards).
                    </p>
                </div>

                <!-- Calculate Button -->
                <button type="submit" id="calculate-btn" class="neumorphism-button">
                    <i class="fa-solid fa-cogs fa-spin"></i> Calculate Tax Liability
                </button>

            </form>
        </section>

        <!-- ====================== -->
        <!--  2. RESULTS SECTION    -->
        <!-- ====================== -->
        <section class="results-section" id="results-section">
            <div id="results-loader">
               <i class="fas fa-sync-alt"></i> Analysing Regimes...
            </div>
            <h2><i class="fa-solid fa-chart-pie"></i> Tax Calculation Insights (AY <span id="result-ay">2024-25</span>)</h2>

            <div class="regime-comparison">
                <!-- Old Regime Card -->
                <div class="result-card" id="old-regime-results" style="--animation-delay: 0.2s;">
                    <h3>Old Tax Regime</h3>
                    <div class="chart-container">
                        <canvas id="oldRegimeChart"></canvas>
                    </div>
                    <div class="result-details">
                         <!-- Results will be populated by JS -->
                    </div>
                    <button class="monthly-toggle" data-target="old-monthly-breakdown">
                         Show Monthly Breakdown <i class="fa-solid fa-chevron-down"></i>
                     </button>
                    <div class="monthly-breakdown" id="old-monthly-breakdown">
                         <!-- Monthly breakdown content -->
                     </div>
                </div>

                <!-- New Regime Card -->
                 <div class="result-card" id="new-regime-results" style="--animation-delay: 0.4s;">
                    <h3>New Tax Regime <small>(Simplified)</small></h3>
                     <div class="chart-container">
                         <canvas id="newRegimeChart"></canvas>
                    </div>
                     <div class="result-details">
                        <!-- Results will be populated by JS -->
                     </div>
                     <button class="monthly-toggle" data-target="new-monthly-breakdown">
                         Show Monthly Breakdown <i class="fa-solid fa-chevron-down"></i>
                    </button>
                     <div class="monthly-breakdown" id="new-monthly-breakdown">
                        <!-- Monthly breakdown content -->
                     </div>
                 </div>
            </div>

            <!-- Comparison Chart -->
            <h3>Regime Comparison</h3>
            <div id="comparison-chart-container">
                <canvas id="comparisonChart"></canvas>
            </div>

             <!-- Tax Saving Suggestions -->
            <section id="suggestions-section">
                <h3><i class="fa-solid fa-lightbulb"></i> Smart Tax Saving Ideas (for Old Regime)</h3>
                <ul id="suggestion-list">
                     <!-- Suggestions populated by JS -->
                     <!-- Example Structure:
                     <li class="suggestion-item" style="--suggestion-index: 0;">
                        <div class="suggestion-icon"><i class="fas fa-piggy-bank"></i></div>
                        <div class="suggestion-text">
                           <p>Utilize the full <strong>â‚¹1,50,000</strong> limit under Section 80C. You can invest an additional <strong>â‚¹<span id="suggest-80c-more">XXX</span></strong> in options like PPF, ELSS, etc.</p>
                        </div>
                    </li>
                     -->
                </ul>
                <p id="no-suggestions" class="text-center text-secondary mt-2" style="display: none;">Looks like you're optimizing well, or these suggestions may not apply to the New Regime!</p>
            </section>


             <!-- Download PDF Button -->
            <button id="download-pdf-btn">
                <i class="fa-solid fa-file-pdf"></i> Download PDF Report
            </button>

        </section>


        <!-- ====================== -->
        <!-- 3. VISUAL GUIDES SECTION -->
        <!-- ====================== -->
        <section class="visual-guides-section" id="visual-guides-section">
             <h2><i class="fa-solid fa-book-open-reader"></i> Understanding Tax Concepts Visually</h2>
            <div class="visual-guides-grid">

                <div class="guide-card" data-anim="fade-in-up"> <!-- Anim #37: Card specific scroll anim -->
                    <img src="https://undraw.co/illustrations/segmentation-394x.svg" alt="Tax Slabs Infographic" class="guide-card-icon" style="width:100px; height:auto;">
                     <h3>Tax Slabs Explained</h3>
                     <p>Understand how different income levels are taxed under both Old and New regimes with clear slab visualizations.</p>
                    <!-- Maybe link to a modal or section with detailed slab tables -->
                </div>

                <div class="guide-card" data-anim="fade-in-up"> <!-- Anim #38: Card specific scroll anim -->
                    <img src="https://undraw.co/illustrations/wallet-bd97.svg" alt="Deductions Infographic" class="guide-card-icon" style="width:100px; height:auto;">
                     <h3>Common Deductions</h3>
                    <p>Explore key deductions like 80C, 80D, HRA, Home Loan interest, and how they reduce your taxable income under the Old Regime.</p>
                 </div>

                 <div class="guide-card" data-anim="fade-in-up"> <!-- Anim #39: Card specific scroll anim -->
                     <img src="https://undraw.co/illustrations/choice-46cm.svg" alt="Regime Comparison Infographic" class="guide-card-icon" style="width:100px; height:auto;">
                     <h3>Old vs. New Regime</h3>
                     <p>Compare the benefits and drawbacks of each tax regime based on your income and investment profile. Make an informed choice!</p>
                 </div>

            </div>
        </section>


    </main>

    <footer>
        <div class="container">
             <p>Disclaimer: This calculator provides estimates based on standard rules for AY <span class="current-ay">2024-25</span>. Consult a tax professional for personalized advice.</p>
             <p>Built with <i class="fa-solid fa-heart" style="color: var(--accent-secondary);"></i> using HTML, CSS, JS, Chart.js, GSAP & jsPDF. | <a href="https://github.com/" target="_blank" rel="noopener noreferrer">View on GitHub (Placeholder)</a></p>
             <!-- Add link to your actual repo when deployed -->
        </div>
    </footer>


    <!-- ====================== -->
    <!--  CDN JAVASCRIPT LIBS   -->
    <!-- ====================== -->
    <!-- GSAP Core & ScrollTrigger Plugin -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js" integrity="sha512-7eHRwcbYkK4d9g/6tD/mhkf++eoTHwpNM9woBxtPUBWm67zeAfFC+HrdoE2GanKeocly/VxeLvIqwvCdk7qScg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js" integrity="sha512-onMTRKJBKz8M1TnqqDuGBlowlH0ohFzMXYRNebz+yOcc5TQr/zAKsthzhuv0hiyUKEiQEQXEynnXCvNTOk50dg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js" integrity="sha512-CQBWl4fJHWbryGE+Pc7UAxWMUMNMWzWxF4SQo9CgkJIN1kx6djDQZjh3Y8SZ1d+6I+1zze6Z7kHXO7q3UyZRAw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- jsPDF & html2canvas -->
     <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" integrity="sha512-qZvrmS2ekKPF2mSznTQsxqPgnpkI4DNTlrdUmTzrDgektczlKNRRhy5X5AAOnx5S09ydFYWWNSfcEqDTTHgtNA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


    <!-- ====================== -->
    <!--  EMBEDDED JAVASCRIPT   -->
    <!-- ====================== -->
    <script>
        // Use strict mode for better error handling
        "use strict";

        // Constants for Tax Slabs and Rules (AY 2024-25 / FY 2023-24)
        // ==============================================================
        const CURRENT_AY = "2024-25";
        const CURRENT_FY = "2023-24";
        const STANDARD_DEDUCTION_SALARIED = 50000;
        const DEDUCTION_80C_LIMIT = 150000;
        const DEDUCTION_NPS_80CCD1B_LIMIT = 50000;
        const HOME_LOAN_INTEREST_LIMIT = 200000;
        const SEC_80TTA_LIMIT = 10000; // Interest on Savings account
        const SEC_80TTB_LIMIT = 50000; // Interest for Senior Citizens (SB + FD)

        // 80D Limits (Example - Can be more granular based on actual rules)
        const DEDUCTION_80D_SELF_BELOW_60 = 25000;
        const DEDUCTION_80D_SELF_ABOVE_60 = 50000;
        const DEDUCTION_80D_PARENTS_BELOW_60 = 25000;
        const DEDUCTION_80D_PARENTS_ABOVE_60 = 50000;

        // OLD Regime Tax Slabs (AY 2024-25)
        const OLD_REGIME_SLABS = {
            below_60: [
                { limit: 250000, rate: 0 },
                { limit: 500000, rate: 0.05 },
                { limit: 1000000, rate: 0.20 },
                { limit: Infinity, rate: 0.30 },
            ],
            // Senior Citizens (60 to 79)
            '60_to_80': [
                { limit: 300000, rate: 0 },
                { limit: 500000, rate: 0.05 },
                { limit: 1000000, rate: 0.20 },
                { limit: Infinity, rate: 0.30 },
            ],
            // Super Senior Citizens (80 and above)
            above_80: [
                { limit: 500000, rate: 0 },
                { limit: 1000000, rate: 0.20 },
                { limit: Infinity, rate: 0.30 },
            ],
        };

        // NEW Regime Tax Slabs (AY 2024-25 - Updated default regime)
        // Note: No tax up to 7 Lakh due to rebate u/s 87A for income <= 7 Lakh
        // But calculation uses slabs, rebate applied at the end.
         const NEW_REGIME_SLABS = [
            { limit: 300000, rate: 0 },       // 0 - 3L = Nil
            { limit: 600000, rate: 0.05 },    // 3L - 6L = 5%
            { limit: 900000, rate: 0.10 },    // 6L - 9L = 10%
            { limit: 1200000, rate: 0.15 },   // 9L - 12L = 15%
            { limit: 1500000, rate: 0.20 },   // 12L - 15L = 20%
            { limit: Infinity, rate: 0.30 },  // Above 15L = 30%
        ];

        const CESS_RATE = 0.04; // Health and Education Cess
        const REBATE_87A_LIMIT_NEW = 700000; // For New Regime
        const REBATE_87A_LIMIT_OLD = 500000; // For Old Regime

        // DOM Elements
        // ==============================================================
         const loader = document.getElementById('loader');
         const header = document.querySelector('header');
         const taxForm = document.getElementById('tax-form');
         const resultsSection = document.getElementById('results-section');
         const resultsLoader = document.getElementById('results-loader');
         const inputSection = document.getElementById('input-section');
         const visualGuidesSection = document.getElementById('visual-guides-section');
         const resultAySpan = document.getElementById('result-ay');
         const oldRegimeResultsContainer = document.getElementById('old-regime-results').querySelector('.result-details');
         const newRegimeResultsContainer = document.getElementById('new-regime-results').querySelector('.result-details');
         const oldRegimeChartCanvas = document.getElementById('oldRegimeChart');
         const newRegimeChartCanvas = document.getElementById('newRegimeChart');
         const comparisonChartCanvas = document.getElementById('comparisonChart');
         const suggestionsList = document.getElementById('suggestion-list');
         const noSuggestionsMsg = document.getElementById('no-suggestions');
         const downloadPdfBtn = document.getElementById('download-pdf-btn');
         const infoIcons = document.querySelectorAll('.info-icon');
         const currentAyElements = document.querySelectorAll('.current-ay');
         const monthlyToggles = document.querySelectorAll('.monthly-toggle');
         const allSections = document.querySelectorAll('main section');
         const allFormGroups = document.querySelectorAll('#tax-form .form-group');
         const guideCards = document.querySelectorAll('.guide-card');

        // Chart instances
         let oldRegimePieChart = null;
         let newRegimePieChart = null;
         let comparisonBarChart = null;


        // GSAP Animations Setup & Functions
        // ==============================================================
        gsap.registerPlugin(ScrollTrigger);

         // Function for smooth number counting animation (Anim #12)
        const animateCounter = (element, endValue, duration = 1.5) => {
            gsap.to(element, {
                textContent: endValue,
                duration: duration,
                ease: "power2.out",
                snap: { textContent: 1 }, // Snap to whole numbers
                onUpdate: function() {
                     // Format as currency while animating if needed (can impact performance)
                     // element.textContent = formatCurrency(Math.ceil(this.targets()[0].textContent));
                     element.textContent = formatCurrency(Math.ceil(element.textContent));
                 },
                 onComplete: function() { // Ensure final value is accurate and formatted
                     element.textContent = formatCurrency(endValue);
                 }
            });
        };

         // Initial Page Load Animations
         const runInitialAnimations = () => {
            // Loader fade out (Anim #0 - implicit)
            const loaderTl = gsap.timeline({
                 onComplete: () => {
                     document.body.style.overflow = 'auto'; // Restore scroll
                     loader.style.display = 'none';
                     // Trigger entrance animations after loader is gone
                    runEntranceAnimations();
                 }
            });
            loaderTl.to(loader, { opacity: 0, duration: 0.7, delay: 1 });

            // Header Animation (Handled by CSS - #1)

             // Initial state for elements animated on scroll
             gsap.set([...allSections, ...guideCards], { opacity: 0, y: 50 });

        };

         const runEntranceAnimations = () => {
            // Input Section fade/slide in (Anim #40: Section Entrance)
            gsap.to(inputSection, { opacity: 1, y: 0, duration: 0.8, ease: 'power2.out', delay: 0.2 });

            // Staggered animation for form elements (CSS Animation #4 handles initial, JS can enhance)
            // Example using JS stagger (optional replacement for CSS one):
            // gsap.from(allFormGroups, {
            //    opacity: 0,
            //    y: 20,
            //    duration: 0.4,
            //    stagger: 0.05,
            //    delay: 0.5, // Delay after section appears
            //    ease: 'power1.out'
            // });

             // Animate 'Calculate' button specifically (Anim #5: Idle pulse is CSS, maybe add entry effect)
             gsap.from("#calculate-btn", { scale: 0.8, opacity: 0, duration: 0.5, delay: 1, ease: 'back.out(1.7)' });

            // Footer Animation (Handled by CSS - #30)

             // ScrollTrigger for other sections/elements (Anim #27, #37, #38, #39 etc.)
             allSections.forEach((section) => {
                if (section !== inputSection) { // Skip input section already animated
                     ScrollTrigger.create({
                        trigger: section,
                        start: "top 85%", // Trigger when 85% from top enters viewport
                        end: "bottom 15%",
                         toggleClass: 'is-visible', // Use CSS class for transition
                        // onEnter: () => gsap.to(section, { opacity: 1, y: 0, duration: 0.7, ease: 'power2.out'}),
                        // onLeaveBack: () => gsap.to(section, { opacity: 0, y: 50, duration: 0.5, ease: 'power2.in'})
                        once: true // Animate only once
                    });
                 }
             });

            guideCards.forEach(card => {
                gsap.to(card, {
                     scrollTrigger: {
                        trigger: card,
                        start: "top 90%",
                        end: "center center",
                        // toggleActions: "play none none reverse", // Example actions
                        scrub: 1, // Smooth scrub effect linked to scroll
                         // Animation for card entrance (Alternative to simple fade)
                         // start: "top 90%", // Starts animation slightly before element fully enters view
                         // end: "top 60%", // Completes animation by the time it's 60% down the view
                        // markers: true // DEBUG
                    },
                     opacity: 1,
                     y: 0,
                     // Add rotation or other effects for "god-level" feel
                    // rotationX: -15, // Example 3D-ish effect
                     duration: 1,
                     ease: 'power3.out'
                 });

                // Add hover animation (Anim #29 - Enhanced by JS if needed)
                card.addEventListener('mouseenter', () => gsap.to(card, { y: -8, scale: 1.03, duration: 0.3, ease: 'power1.out' }));
                 card.addEventListener('mouseleave', () => gsap.to(card, { y: 0, scale: 1, duration: 0.3, ease: 'power1.out' }));
             });

        };

        // Function to show/hide Results Loader (Anim #9 - JS controls opacity)
         const showResultsLoader = (show = true) => {
             gsap.to(resultsLoader, {
                 opacity: show ? 1 : 0,
                 duration: 0.3,
                 onStart: () => { if(show) resultsLoader.style.pointerEvents = 'auto'; },
                 onComplete: () => { if(!show) resultsLoader.style.pointerEvents = 'none'; }
             });
         };


        // Utility Functions
        // ==============================================================
        const formatCurrency = (value, decimals = 0) => {
            const num = Number(value);
             if (isNaN(num)) return 'â‚¹ 0';
            // Use Intl.NumberFormat for robust currency formatting
            return num.toLocaleString('en-IN', {
                style: 'currency',
                currency: 'INR',
                minimumFractionDigits: decimals,
                maximumFractionDigits: decimals,
            });
        };

        // Helper to get input value as number, defaulting to 0
        const getInputValue = (id) => {
            const element = document.getElementById(id);
             return element ? parseFloat(element.value) || 0 : 0;
        };

        // Helper to get selected value
        const getSelectedValue = (id) => {
            const element = document.getElementById(id);
            return element ? element.value : null;
        };

        // Simple validation feedback (could be expanded)
        const showInputError = (id, message) => {
            const element = document.getElementById(id);
             if (element) {
                element.style.border = '1px solid var(--error-color)';
                // Could add error message display here
                 console.warn(`Validation Error for ${id}: ${message}`);
            }
        };
        const clearInputError = (id) => {
            const element = document.getElementById(id);
            if (element) element.style.border = '1px solid var(--border-color)';
        };


        // Core Tax Calculation Logic
        // ==============================================================

         // Calculate tax based on slabs
         const calculateSlabTax = (income, slabs) => {
            let tax = 0;
             let remainingIncome = income;
             let lastLimit = 0;

             for (const slab of slabs) {
                if (remainingIncome <= 0) break;
                 const taxableInSlab = Math.min(remainingIncome, slab.limit - lastLimit);
                 tax += taxableInSlab * slab.rate;
                 remainingIncome -= taxableInSlab;
                 lastLimit = slab.limit;
            }
            return tax;
        };

         // Calculate HRA Exemption
         const calculateHraExemption = (basic, hraReceived, rentPaid, isMetro) => {
             if (hraReceived <= 0 || rentPaid <= 0) return 0;

             // 1. Actual HRA Received
             const condition1 = hraReceived;
             // 2. Rent Paid minus 10% of Basic Salary
             const condition2 = Math.max(0, rentPaid - (0.10 * basic));
             // 3. 50% of Basic Salary (Metro) or 40% (Non-Metro)
             const condition3 = (isMetro === 'yes' ? 0.50 : 0.40) * basic;

            // Exemption is the minimum of the three
             return Math.min(condition1, condition2, condition3);
        };

         // Calculate 80D Deduction Limit
         const calculate80DLimit = (ageGroup, isParents, parentsSenior) => {
             let selfLimit = (ageGroup === 'below_60') ? DEDUCTION_80D_SELF_BELOW_60 : DEDUCTION_80D_SELF_ABOVE_60;

             if (!isParents) {
                 return selfLimit;
             } else {
                let parentLimit = (parentsSenior === 'yes') ? DEDUCTION_80D_PARENTS_ABOVE_60 : DEDUCTION_80D_PARENTS_BELOW_60;
                // Note: In combined policies, the rules can be complex. This is simplified.
                 // Assuming separate calculations here for simplicity based on inputs.
                // If only paying for parents, this limit applies to parent contribution.
                // If paying for both, the *total* 80D is capped based on combination, requires more detailed UI/logic
                return parentLimit; // Return the applicable limit for the parent component input
             }
         };


        // Main Calculation Function
         const calculateTaxLiability = (inputs) => {
            // --- 1. Calculate Gross Salary & Total Gross Income ---
             const grossSalary = inputs.basicSalary + inputs.hraReceived + inputs.otherAllowances;
             const totalGrossIncome = grossSalary + inputs.incomeOtherSources;

            // --- 2. Calculate Deductions & Taxable Income (OLD REGIME) ---
            let totalDeductionsOld = 0;

            // Standard Deduction (Salaried)
             totalDeductionsOld += STANDARD_DEDUCTION_SALARIED; // Assuming salaried

            // HRA Exemption
            const hraExemption = calculateHraExemption(inputs.basicSalary, inputs.hraReceived, inputs.rentPaid, inputs.metroCity);
             totalDeductionsOld += hraExemption;

             // Sec 80C (Capped)
            const deduction80C = Math.min(inputs.deduction80C, DEDUCTION_80C_LIMIT);
             totalDeductionsOld += deduction80C;

            // Sec 80D (Self/Family) - Needs capping logic based on age
             const self80DLimit = calculate80DLimit(inputs.ageGroup, false, null);
            const deduction80D = Math.min(inputs.deduction80D, self80DLimit);
             totalDeductionsOld += deduction80D;

            // Sec 80D (Parents) - Needs capping logic based on parents' age
            const parents80DLimit = calculate80DLimit(null, true, inputs.parentsSenior);
             const deduction80DParents = Math.min(inputs.deduction80DParents, parents80DLimit);
             totalDeductionsOld += deduction80DParents;

            // Sec 24b: Home Loan Interest (Capped)
             const deductionHomeLoan = Math.min(inputs.homeLoanInterest, HOME_LOAN_INTEREST_LIMIT);
             totalDeductionsOld += deductionHomeLoan;

            // Sec 80TTA / 80TTB
             const isSenior = inputs.ageGroup !== 'below_60';
             const interestLimit = isSenior ? SEC_80TTB_LIMIT : SEC_80TTA_LIMIT;
             const actualInterestIncome = inputs.deduction80TTA; // Assuming this input IS the actual interest
             const deduction80TTA_TTB = Math.min(actualInterestIncome, interestLimit);
            totalDeductionsOld += deduction80TTA_TTB;

            // Sec 80CCD(1B) - NPS (Capped)
            const deductionNPS = Math.min(inputs.deductionNPS, DEDUCTION_NPS_80CCD1B_LIMIT);
             totalDeductionsOld += deductionNPS;

             // Add any other relevant deductions here (e.g., 80G, 80E) if UI is expanded

             const taxableIncomeOld = Math.max(0, totalGrossIncome - totalDeductionsOld);


            // --- 3. Calculate Tax (OLD REGIME) ---
             const oldRegimeSlabs = OLD_REGIME_SLABS[inputs.ageGroup];
             let taxOldBeforeRebate = calculateSlabTax(taxableIncomeOld, oldRegimeSlabs);

             // Rebate u/s 87A (Old Regime)
             let rebateOld = 0;
             if (taxableIncomeOld <= REBATE_87A_LIMIT_OLD) {
                 rebateOld = Math.min(taxOldBeforeRebate, 12500);
            }
            let taxOldAfterRebate = Math.max(0, taxOldBeforeRebate - rebateOld);

            // Add Cess
            let cessOld = taxOldAfterRebate * CESS_RATE;
            let totalTaxOld = taxOldAfterRebate + cessOld;


            // --- 4. Calculate Taxable Income & Tax (NEW REGIME - AY 2024-25) ---
            // Primary allowed deduction is Standard Deduction. Some others might apply (NPS Employer), but keeping simple for now.
             let totalDeductionsNew = STANDARD_DEDUCTION_SALARIED;
             const taxableIncomeNew = Math.max(0, totalGrossIncome - totalDeductionsNew);

             // Calculate Tax (New Regime)
             let taxNewBeforeRebate = calculateSlabTax(taxableIncomeNew, NEW_REGIME_SLABS);

             // Rebate u/s 87A (New Regime - Updated)
             let rebateNew = 0;
            if (taxableIncomeNew <= REBATE_87A_LIMIT_NEW) {
                 // Full rebate making tax zero for income up to 7L
                 rebateNew = taxNewBeforeRebate;
                 // Technically rebate is capped at 25k, but slabs+rebate make tax 0 up to 7L anyway.
                 // For calculation transparency, we can show the rebate amount
                 // Example: Income = 6L, Tax=15k, Rebate=15k, Final=0. Income = 7L, Tax=25k, Rebate=25k, Final=0.
                 // Income=7.1L, Tax=26.5k, Rebate=0, Final=26.5k+cess.
                 // So setting rebate equal to tax effectively handles this.
            }
             let taxNewAfterRebate = Math.max(0, taxNewBeforeRebate - rebateNew);

             // Add Cess
             let cessNew = taxNewAfterRebate * CESS_RATE;
             let totalTaxNew = taxNewAfterRebate + cessNew;

            // --- 5. Package Results ---
            return {
                oldRegime: {
                    grossIncome: totalGrossIncome,
                    totalDeductions: totalDeductionsOld,
                    taxableIncome: taxableIncomeOld,
                    taxBeforeRebate: taxOldBeforeRebate,
                    rebate87A: rebateOld,
                    taxAfterRebate: taxOldAfterRebate,
                    cess: cessOld,
                    totalTax: totalTaxOld,
                     // Individual deduction breakdown for display
                    deductionsBreakdown: {
                        stdDeduction: STANDARD_DEDUCTION_SALARIED,
                        hra: hraExemption,
                         '80C': deduction80C,
                         '80D': deduction80D + deduction80DParents, // Combined for simplicity in summary
                         'homeLoan': deductionHomeLoan,
                         '80TTA/TTB': deduction80TTA_TTB,
                         '80CCD(1B)': deductionNPS,
                    }
                },
                newRegime: {
                     grossIncome: totalGrossIncome,
                     totalDeductions: totalDeductionsNew, // Primarily Standard Deduction
                     taxableIncome: taxableIncomeNew,
                     taxBeforeRebate: taxNewBeforeRebate,
                     rebate87A: rebateNew,
                     taxAfterRebate: taxNewAfterRebate,
                    cess: cessNew,
                     totalTax: totalTaxNew,
                      deductionsBreakdown: {
                        stdDeduction: STANDARD_DEDUCTION_SALARIED,
                        // New regime has limited other deductions generally
                     }
                },
                 inputs: inputs // Pass back inputs for context if needed later
             };
        };

        // Charting Functions (using Chart.js)
        // ==============================================================
        const createOrUpdatePieChart = (canvasId, chartInstance, data, labels) => {
             const ctx = document.getElementById(canvasId).getContext('2d');
             const chartData = {
                 labels: labels,
                 datasets: [{
                     data: data,
                     backgroundColor: [ // Futuristic color scheme
                         'rgba(0, 207, 255, 0.7)', // accent-primary
                         'rgba(168, 85, 247, 0.7)', // accent-secondary
                         'rgba(46, 204, 113, 0.7)', // success
                         'rgba(243, 156, 18, 0.7)', // warning
                         'rgba(231, 76, 60, 0.7)', // error
                         'rgba(52, 152, 219, 0.7)' // another blue
                     ],
                     borderColor: var(--bg-secondary),
                     borderWidth: 2,
                     hoverOffset: 8 // Animation #41: Pie slice hover pop
                 }]
             };

             const options = {
                 responsive: true,
                 maintainAspectRatio: false,
                 plugins: {
                     legend: {
                         position: 'bottom',
                         labels: {
                            color: var(--text-secondary),
                            font: { size: 11 }, // Smaller legend font
                             boxWidth: 15,
                             padding: 15
                        }
                     },
                     tooltip: {
                        enabled: true,
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleColor: var(--accent-primary),
                        bodyColor: var(--text-primary),
                         callbacks: {
                             label: function(context) {
                                 let label = context.label || '';
                                 if (label) { label += ': '; }
                                if (context.parsed !== null) {
                                     label += formatCurrency(context.parsed);
                                }
                                return label;
                            }
                        }
                    }
                 },
                animation: {
                    animateRotate: true, // Anim #42: Chart initial rotation
                    animateScale: true, // Anim #43: Chart initial scale
                     duration: 1200,
                     easing: 'easeInOutQuart'
                 },
                 layout: {
                     padding: { top: 10, bottom: 10, left: 10, right: 10 }
                 }
             };

             if (chartInstance) {
                // Update existing chart
                 chartInstance.data = chartData;
                 chartInstance.options = options; // Ensure options update if needed
                 chartInstance.update();
                // Optional GSAP animation around the update (Anim #44)
                 // gsap.from(canvasId, {scale: 0.9, opacity: 0.5, duration: 0.5, ease: 'power1.out'});
             } else {
                 // Create new chart
                return new Chart(ctx, { type: 'doughnut', data: chartData, options: options });
             }
        };

        const createOrUpdateBarChart = (canvasId, chartInstance, dataSets, labels) => {
             const ctx = document.getElementById(canvasId).getContext('2d');
             const chartData = {
                 labels: labels,
                 datasets: dataSets // Expecting [{ label: 'Old', data: [...], backgroundColor: ... }, ...]
             };

             const options = {
                 responsive: true,
                 maintainAspectRatio: false,
                 indexAxis: 'y', // Horizontal bars might look better for comparison
                 scales: {
                    x: {
                        beginAtZero: true,
                        ticks: { color: var(--text-secondary), font: { size: 10 } },
                        grid: { color: var(--border-color), drawTicks: false },
                        title: { display: true, text: 'Amount (â‚¹)', color: var(--text-secondary) }
                    },
                    y: {
                        ticks: { color: var(--text-primary), font: { size: 11 } },
                         grid: { display: false }, // Hide vertical grid lines
                    }
                 },
                 plugins: {
                     legend: {
                         position: 'top',
                         labels: { color: var(--text-secondary), font: { size: 12 } }
                     },
                      tooltip: {
                        enabled: true,
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                         titleFont: { weight: 'bold' },
                         callbacks: {
                            label: function(context) {
                                 return `${context.dataset.label}: ${formatCurrency(context.raw)}`;
                             }
                        }
                    }
                },
                 animation: {
                     duration: 1000,
                     easing: 'easeOutBounce' // Anim #45: Bar animation bounce
                 }
             };

             if (chartInstance) {
                chartInstance.data = chartData;
                chartInstance.options = options;
                chartInstance.update();
             } else {
                 return new Chart(ctx, { type: 'bar', data: chartData, options: options });
            }
         };

         // Update UI with Results
        // ==============================================================
        const updateUI = (results) => {

             // Show Results Section with animation (Anim #46: Section reveal)
             resultsSection.style.display = 'block';
            gsap.to(resultsSection, { opacity: 1, y: 0, duration: 0.7, ease: 'power2.out' });

            resultAySpan.textContent = CURRENT_AY;

            // Populate Old Regime Card
            oldRegimeResultsContainer.innerHTML = `
                <div class="result-item" style="--item-index: 1;"><span>Gross Income:</span> <span data-value="${results.oldRegime.grossIncome}">${formatCurrency(0)}</span></div>
                <div class="result-item" style="--item-index: 2;"><span>Total Deductions:</span> <span data-value="${results.oldRegime.totalDeductions}">${formatCurrency(0)}</span></div>
                <div class="result-item" style="--item-index: 3;"><span>Taxable Income:</span> <span data-value="${results.oldRegime.taxableIncome}">${formatCurrency(0)}</span></div>
                <div class="result-item" style="--item-index: 4;"><span>Income Tax:</span> <span data-value="${results.oldRegime.taxBeforeRebate}">${formatCurrency(0)}</span></div>
                <div class="result-item" style="--item-index: 5;"><span>Rebate u/s 87A:</span> <span data-value="${results.oldRegime.rebate87A}">${formatCurrency(0)}</span></div>
                 <div class="result-item" style="--item-index: 6;"><span>Tax After Rebate:</span> <span data-value="${results.oldRegime.taxAfterRebate}">${formatCurrency(0)}</span></div>
                <div class="result-item" style="--item-index: 7;"><span>Cess (4%):</span> <span data-value="${results.oldRegime.cess}">${formatCurrency(0)}</span></div>
                 <hr style="border-color: var(--border-color); margin: 0.8rem 0;">
                <div class="result-item" style="--item-index: 8;"><strong>Total Tax Payable:</strong> <strong class="tax-amount" data-value="${results.oldRegime.totalTax}">${formatCurrency(0)}</strong></div>
            `;

             // Populate New Regime Card
            newRegimeResultsContainer.innerHTML = `
                <div class="result-item" style="--item-index: 1;"><span>Gross Income:</span> <span data-value="${results.newRegime.grossIncome}">${formatCurrency(0)}</span></div>
                <div class="result-item" style="--item-index: 2;"><span>Total Deductions:</span> <span data-value="${results.newRegime.totalDeductions}">${formatCurrency(0)}</span> <small>(Mainly Std Ded.)</small></div>
                <div class="result-item" style="--item-index: 3;"><span>Taxable Income:</span> <span data-value="${results.newRegime.taxableIncome}">${formatCurrency(0)}</span></div>
                <div class="result-item" style="--item-index: 4;"><span>Income Tax:</span> <span data-value="${results.newRegime.taxBeforeRebate}">${formatCurrency(0)}</span></div>
                <div class="result-item" style="--item-index: 5;"><span>Rebate u/s 87A:</span> <span data-value="${results.newRegime.rebate87A}">${formatCurrency(0)}</span></div>
                <div class="result-item" style="--item-index: 6;"><span>Tax After Rebate:</span> <span data-value="${results.newRegime.taxAfterRebate}">${formatCurrency(0)}</span></div>
                <div class="result-item" style="--item-index: 7;"><span>Cess (4%):</span> <span data-value="${results.newRegime.cess}">${formatCurrency(0)}</span></div>
                <hr style="border-color: var(--border-color); margin: 0.8rem 0;">
                <div class="result-item" style="--item-index: 8;"><strong>Total Tax Payable:</strong> <strong class="tax-amount" data-value="${results.newRegime.totalTax}">${formatCurrency(0)}</strong></div>
             `;

             // Trigger number counter animations after HTML is populated
            document.querySelectorAll('.result-details span[data-value], .result-details strong[data-value]').forEach(span => {
                animateCounter(span, parseFloat(span.dataset.value));
            });

            // Generate Data for Old Regime Pie Chart (Tax Components)
            const oldTaxComponentsData = [
                 Math.max(0, results.oldRegime.taxAfterRebate), // Base Tax (after rebate)
                 results.oldRegime.cess                 // Cess
            ];
            const oldTaxComponentsLabels = [
                 'Income Tax',
                 'Health & Edu Cess'
             ];
            // Add non-taxable income if visualising total income pie
            // const nonTaxableOld = results.oldRegime.grossIncome - results.oldRegime.taxableIncome;
            // const netIncomeOld = results.oldRegime.taxableIncome - results.oldRegime.taxAfterRebate - results.oldRegime.cess; // Approximate take home

             // Filter out zero values for cleaner charts
             const filteredOldData = [];
             const filteredOldLabels = [];
             oldTaxComponentsData.forEach((val, index) => {
                if (val > 0) {
                    filteredOldData.push(val);
                     filteredOldLabels.push(oldTaxComponentsLabels[index]);
                 }
             });
            // Optionally, show 'Net Income' portion
             const netIncomeOld = results.oldRegime.grossIncome - results.oldRegime.totalTax;
             if (netIncomeOld > 0) {
                 filteredOldData.push(netIncomeOld);
                 filteredOldLabels.push('Net Income (Est.)');
             }

            if (filteredOldData.reduce((a, b) => a + b, 0) > 0) { // Only draw chart if there's data
                 oldRegimePieChart = createOrUpdatePieChart(oldRegimeChartCanvas.id, oldRegimePieChart, filteredOldData, filteredOldLabels);
             } else {
                // Clear or hide chart if no tax/income
                 if (oldRegimePieChart) oldRegimePieChart.destroy();
                oldRegimePieChart = null;
                 // Optionally display a message
                oldRegimeResultsContainer.insertAdjacentHTML('afterbegin', '<p class="text-center text-secondary mb-2">No tax applicable under this regime.</p>');
            }


            // Generate Data for New Regime Pie Chart
            const newTaxComponentsData = [
                Math.max(0, results.newRegime.taxAfterRebate),
                 results.newRegime.cess
             ];
            const newTaxComponentsLabels = [
                'Income Tax',
                'Health & Edu Cess'
            ];
             const filteredNewData = [];
             const filteredNewLabels = [];
             newTaxComponentsData.forEach((val, index) => {
                if (val > 0) {
                    filteredNewData.push(val);
                    filteredNewLabels.push(newTaxComponentsLabels[index]);
                 }
            });
            const netIncomeNew = results.newRegime.grossIncome - results.newRegime.totalTax;
            if (netIncomeNew > 0) {
                filteredNewData.push(netIncomeNew);
                filteredNewLabels.push('Net Income (Est.)');
             }


            if (filteredNewData.reduce((a, b) => a + b, 0) > 0) {
                newRegimePieChart = createOrUpdatePieChart(newRegimeChartCanvas.id, newRegimePieChart, filteredNewData, filteredNewLabels);
             } else {
                 if (newRegimePieChart) newRegimePieChart.destroy();
                 newRegimePieChart = null;
                newRegimeResultsContainer.insertAdjacentHTML('afterbegin', '<p class="text-center text-secondary mb-2">No tax applicable under this regime.</p>');
             }

             // Generate Data for Comparison Bar Chart (Taxable Income & Total Tax)
            const comparisonLabels = ['Total Tax Payable', 'Taxable Income'];
            const comparisonDatasets = [
                 {
                    label: 'Old Regime',
                    data: [results.oldRegime.totalTax, results.oldRegime.taxableIncome],
                    backgroundColor: 'rgba(0, 207, 255, 0.7)', // Cyan
                    borderColor: 'rgba(0, 207, 255, 1)',
                     borderWidth: 1,
                     barThickness: 30, // Adjust bar thickness
                     borderRadius: 5, // Rounded bars
                },
                 {
                    label: 'New Regime',
                    data: [results.newRegime.totalTax, results.newRegime.taxableIncome],
                    backgroundColor: 'rgba(168, 85, 247, 0.7)', // Purple
                     borderColor: 'rgba(168, 85, 247, 1)',
                     borderWidth: 1,
                     barThickness: 30,
                     borderRadius: 5,
                }
            ];
             comparisonBarChart = createOrUpdateBarChart(comparisonChartCanvas.id, comparisonBarChart, comparisonDatasets, comparisonLabels);

             // Update Monthly Breakdowns
            updateMonthlyBreakdown('old', results.oldRegime);
            updateMonthlyBreakdown('new', results.newRegime);


            // Generate Tax Saving Suggestions
            generateSuggestions(results);

             // Scroll smoothly to results section
            // Check screen size, scroll less aggressively on mobile
            const offset = window.innerWidth < 768 ? header.offsetHeight + 10 : 30; // Offset below sticky header
            gsap.to(window, { duration: 1, scrollTo: { y: `#${resultsSection.id}`, offsetY: offset }, ease: "power3.inOut" });
             // resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });


        };

        const updateMonthlyBreakdown = (regime, regimeResults) => {
           const containerId = `${regime}-monthly-breakdown`;
           const container = document.getElementById(containerId);
            if (!container) return;

            const monthlyGross = regimeResults.grossIncome / 12;
            const monthlyDeductions = regimeResults.totalDeductions / 12;
            const monthlyTaxable = regimeResults.taxableIncome / 12;
            const monthlyTotalTax = regimeResults.totalTax / 12;
            const monthlyNet = monthlyGross - monthlyTotalTax; // Rough estimate

             container.innerHTML = `
                 <p><span>Avg. Monthly Gross Income:</span> <span>${formatCurrency(monthlyGross)}</span></p>
                 <p><span>Avg. Monthly Deductions:</span> <span>${formatCurrency(monthlyDeductions)}</span></p>
                 <p><span>Avg. Monthly Taxable Income:</span> <span>${formatCurrency(monthlyTaxable)}</span></p>
                <p><span>Avg. Monthly Tax (incl. Cess):</span> <span style="color: var(--accent-secondary); font-weight: bold;">${formatCurrency(monthlyTotalTax)}</span></p>
                <hr style="border-color: var(--border-color); margin: 0.5rem 0;">
                 <p><strong>Avg. Est. Monthly Net Income:</strong> <strong>${formatCurrency(monthlyNet)}</strong></p>
             `;
        };

         // Tax Saving Suggestions Logic
        // ==============================================================
        const generateSuggestions = (results) => {
             suggestionsList.innerHTML = ''; // Clear previous suggestions
            let suggestionCount = 0;
             const inputs = results.inputs; // Get original inputs for comparison

            // Suggestions primarily apply when Old Regime is considered or potentially beneficial
            // 1. Section 80C Suggestion
             const current80C = Math.min(inputs.deduction80C, DEDUCTION_80C_LIMIT);
             const potential80CMore = DEDUCTION_80C_LIMIT - current80C;
            if (potential80CMore > 1000) { // Suggest only if significant potential
                 suggestionsList.innerHTML += `
                     <li class="suggestion-item" style="--suggestion-index: ${suggestionCount++};">
                        <div class="suggestion-icon"><i class="fas fa-coins"></i></div>
                        <div class="suggestion-text">
                             <p>Maximize <strong>Section 80C</strong> savings by investing an additional <strong>${formatCurrency(potential80CMore)}</strong> in PPF, ELSS, Term Insurance, etc. (Old Regime).</p>
                        </div>
                    </li>`;
            }

             // 2. Section 80D Suggestion (simplified)
             const self80DLimit = calculate80DLimit(inputs.ageGroup, false, null);
             const parent80DLimit = calculate80DLimit(null, true, inputs.parentsSenior);
             const current80D = Math.min(inputs.deduction80D, self80DLimit);
             const currentParent80D = Math.min(inputs.deduction80DParents, parent80DLimit);
             const potential80DMore = self80DLimit - current80D;
             const potentialParent80DMore = parent80DLimit - currentParent80D;

             if (potential80DMore > 1000) {
                 suggestionsList.innerHTML += `
                     <li class="suggestion-item" style="--suggestion-index: ${suggestionCount++};">
                         <div class="suggestion-icon"><i class="fas fa-heartbeat"></i></div>
                         <div class="suggestion-text">
                             <p>Consider increasing your <strong>Section 80D</strong> health insurance premium coverage for self/family by up to <strong>${formatCurrency(potential80DMore)}</strong> (Old Regime).</p>
                         </div>
                    </li>`;
             }
             if (inputs.deduction80DParents >= 0 && potentialParent80DMore > 1000) { // Check if input field was potentially used
                 suggestionsList.innerHTML += `
                    <li class="suggestion-item" style="--suggestion-index: ${suggestionCount++};">
                         <div class="suggestion-icon"><i class="fas fa-user-md"></i></div>
                         <div class="suggestion-text">
                             <p>Utilize the separate limit for <strong>parents' health insurance (80D)</strong>. You could claim up to an additional <strong>${formatCurrency(potentialParent80DMore)}</strong> (Old Regime).</p>
                        </div>
                    </li>`;
             }

             // 3. HRA Suggestion (if applicable but not claimed effectively)
             if (inputs.hraReceived > 0 && inputs.rentPaid > 0 && results.oldRegime.deductionsBreakdown.hra < inputs.hraReceived && (results.oldRegime.deductionsBreakdown.hra < Math.max(0, inputs.rentPaid - 0.10 * inputs.basicSalary)) ) {
                 // Check if calculated HRA exemption is low despite inputs suggesting potential
                suggestionsList.innerHTML += `
                     <li class="suggestion-item" style="--suggestion-index: ${suggestionCount++};">
                         <div class="suggestion-icon"><i class="fas fa-home"></i></div>
                        <div class="suggestion-text">
                             <p>Ensure you're claiming the maximum possible <strong>HRA exemption</strong> based on your rent slips and salary structure (Old Regime).</p>
                         </div>
                     </li>`;
            }

            // 4. NPS 80CCD(1B) Suggestion
             const currentNPS = Math.min(inputs.deductionNPS, DEDUCTION_NPS_80CCD1B_LIMIT);
             const potentialNPSMore = DEDUCTION_NPS_80CCD1B_LIMIT - currentNPS;
            if (potentialNPSMore > 1000) {
                suggestionsList.innerHTML += `
                     <li class="suggestion-item" style="--suggestion-index: ${suggestionCount++};">
                        <div class="suggestion-icon"><i class="fas fa-chart-line"></i></div>
                         <div class="suggestion-text">
                             <p>Explore investing up to <strong>${formatCurrency(potentialNPSMore)}</strong> more in <strong>NPS under Section 80CCD(1B)</strong> for additional tax benefits (Old Regime, sometimes New).</p>
                         </div>
                     </li>`;
             }

             // 5. Home Loan Interest Suggestion
             const currentHomeLoanInt = Math.min(inputs.homeLoanInterest, HOME_LOAN_INTEREST_LIMIT);
            const potentialHomeLoanMore = HOME_LOAN_INTEREST_LIMIT - currentHomeLoanInt;
            if (inputs.homeLoanInterest === 0 && potentialHomeLoanMore === HOME_LOAN_INTEREST_LIMIT) {
                 // Suggest considering home loan if no input was provided but could be applicable
                // suggestionsList.innerHTML += `<li ...>If you have a home loan, remember to claim interest...</li>`;
            } else if (potentialHomeLoanMore > 1000 && currentHomeLoanInt > 0) {
                 // Suggest checking if full potential is claimed if partially claimed
                 suggestionsList.innerHTML += `
                    <li class="suggestion-item" style="--suggestion-index: ${suggestionCount++};">
                        <div class="suggestion-icon"><i class="fas fa-house-damage"></i></div>
                         <div class="suggestion-text">
                             <p>Ensure you're claiming the full eligible amount for <strong>Home Loan Interest (Sec 24b)</strong>, up to <strong>${formatCurrency(HOME_LOAN_INTEREST_LIMIT)}</strong> if applicable (Old Regime).</p>
                         </div>
                     </li>`;
             }


             // Show/Hide "No Suggestions" message
            noSuggestionsMsg.style.display = suggestionCount === 0 ? 'block' : 'none';

            // Animate suggestions section if it wasn't already visible (handled by scroll trigger usually)
             if (!suggestionsSection.classList.contains('is-visible')) {
                suggestionsSection.classList.add('is-visible'); // Ensure CSS transition triggers
             }

             // Animate the list items appearing (using GSAP this time)
            gsap.from(".suggestion-item", {
                opacity: 0,
                scale: 0.9,
                 y: 10,
                 duration: 0.5,
                 stagger: 0.15,
                 ease: "back.out(1.5)", // Playful bounce effect
                scrollTrigger: { // Only animate when suggestion list comes into view
                    trigger: suggestionsList,
                     start: "top 90%", // Adjust trigger point
                    // toggleActions: "play none none none",
                     once: true
                }
            });
        };

        // PDF Generation
        // ==============================================================
        const generatePDF = async () => {
            const { jsPDF } = window.jspdf; // Get jsPDF from window object
            const pdf = new jsPDF({
                orientation: 'p',
                unit: 'px',
                format: 'a4', // Approximate a4 size in pixels
                putOnlyUsedFonts: true,
                // hotfixes: ['px_scaling'] // May help with scaling issues
            });

            // Show a temporary message or disable button
             downloadPdfBtn.disabled = true;
             downloadPdfBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating PDF...';


            try {
                 // 1. Define the content area to capture
                 const contentToCapture = resultsSection; // Capture the entire results section
                 const pdfContentWrapper = document.createElement('div');
                 pdfContentWrapper.classList.add('pdf-content'); // Apply PDF specific styles
                 pdfContentWrapper.innerHTML = contentToCapture.innerHTML; // Clone the content


                 // Temporarily append to body off-screen to render for canvas
                 pdfContentWrapper.style.position = 'absolute';
                 pdfContentWrapper.style.left = '-9999px';
                 pdfContentWrapper.style.top = '-9999px';
                 pdfContentWrapper.style.width = '800px'; // Define a width for rendering consistency
                 pdfContentWrapper.style.background = 'var(--bg-primary)'; // Ensure bg color
                document.body.appendChild(pdfContentWrapper);


                 // IMPORTANT: Render charts on temporary canvases within the pdf wrapper
                // We need to draw the *existing* charts onto new canvas elements inside pdfContentWrapper
                // because html2canvas captures the current state, including animations which might be finished.
                 const oldChartCanvasPdf = pdfContentWrapper.querySelector('#oldRegimeChart');
                const newChartCanvasPdf = pdfContentWrapper.querySelector('#newRegimeChart');
                const compChartCanvasPdf = pdfContentWrapper.querySelector('#comparisonChart');

                 // Create image data URLs from the original charts
                 const oldChartImg = oldRegimePieChart ? oldRegimePieChart.toBase64Image() : null;
                 const newChartImg = newRegimePieChart ? newRegimePieChart.toBase64Image() : null;
                 const compChartImg = comparisonBarChart ? comparisonBarChart.toBase64Image() : null;

                // Draw the images onto the PDF canvases (or just insert images later in PDF)
                // Alternative: directly add images to PDF below

                 // Remove original canvas elements from PDF clone to avoid blank spaces
                 if(oldChartCanvasPdf) oldChartCanvasPdf.parentNode.removeChild(oldChartCanvasPdf);
                 if(newChartCanvasPdf) newChartCanvasPdf.parentNode.removeChild(newChartCanvasPdf);
                 if(compChartCanvasPdf) compChartCanvasPdf.parentNode.removeChild(compChartCanvasPdf);


                 // Wait a short moment for rendering (may be needed)
                await new Promise(resolve => setTimeout(resolve, 300));


                // 2. Use html2canvas to capture the prepared wrapper
                const canvas = await html2canvas(pdfContentWrapper, {
                     scale: 2, // Increase resolution for better quality
                    useCORS: true, // If using external images/fonts via CDN
                     backgroundColor: 'var(--bg-primary)', // Explicitly set background
                     logging: false // Disable console logs from html2canvas
                 });

                // Remove the temporary wrapper
                document.body.removeChild(pdfContentWrapper);

                 const imgData = canvas.toDataURL('image/png');

                 // 3. Add image to PDF
                 const imgProps = pdf.getImageProperties(imgData);
                 const pdfWidth = pdf.internal.pageSize.getWidth();
                 const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

                 pdf.setFont(var(--font-display), 'bold'); // Use display font
                 pdf.setTextColor(var(--accent-primary));
                 pdf.setFontSize(18);
                pdf.text("Income Tax Calculation Summary", pdfWidth / 2, 30, { align: 'center' });

                pdf.setFont(var(--font-primary), 'normal');
                pdf.setFontSize(10);
                pdf.setTextColor(var(--text-secondary));
                pdf.text(`Assessment Year: ${CURRENT_AY} (Financial Year: ${CURRENT_FY})`, pdfWidth / 2, 45, { align: 'center'});

                // Add captured HTML content image
                 let imgY = 60; // Starting Y position for the main content image
                pdf.addImage(imgData, 'PNG', 15, imgY, pdfWidth - 30, pdfHeight - 15); // Adjust padding/margins

                // Add charts separately (Alternative to including in html2canvas)
                 // This gives more control over placement and prevents capture issues.
                // Example: Add comparison chart below text
                 // if (compChartImg) {
                 //     const compImgProps = pdf.getImageProperties(compChartImg);
                //     const compPdfWidth = pdfWidth * 0.7; // Make chart smaller
                 //     const compPdfHeight = (compImgProps.height * compPdfWidth) / compImgProps.width;
                 //     const compX = (pdfWidth - compPdfWidth) / 2;
                 //     const compY = imgY + pdfHeight + 20; // Position after main content
                 //     pdf.addImage(compChartImg, 'PNG', compX, compY, compPdfWidth, compPdfHeight);
                 // }


                // 4. Save the PDF
                 pdf.save(`Income_Tax_Summary_${CURRENT_AY}.pdf`);

            } catch (error) {
                console.error("Error generating PDF:", error);
                 alert("Oops! Something went wrong while generating the PDF. Please try again.");
            } finally {
                 // Restore button state
                downloadPdfBtn.disabled = false;
                downloadPdfBtn.innerHTML = '<i class="fa-solid fa-file-pdf"></i> Download PDF Report';
            }
        };

        // Event Listeners
        // ==============================================================
         const setupEventListeners = () => {
            taxForm.addEventListener('submit', (event) => {
                event.preventDefault(); // Prevent default form submission
                 // Basic Validation Example
                 let isValid = true;
                 const basicSalaryInput = document.getElementById('basic-salary');
                 if (!basicSalaryInput.value || getInputValue('basic-salary') < 0) {
                    showInputError('basic-salary', 'Basic Salary is required and cannot be negative.');
                     isValid = false;
                     basicSalaryInput.focus(); // Focus first invalid field
                } else {
                    clearInputError('basic-salary');
                 }

                // Add more validation for other fields as needed...

                 if (isValid) {
                    // Show loader while calculating
                     showResultsLoader(true);
                     resultsSection.style.display = 'block'; // Make sure section exists for loader
                     gsap.to(resultsSection, { opacity: 0.5, duration: 0 }); // Fade slightly for loader effect

                     // Get all input values
                     const inputs = {
                        assessmentYear: getSelectedValue('assessment-year'),
                         taxPayerType: getSelectedValue('tax-payer-type'),
                         ageGroup: getSelectedValue('age-group'),
                         residentialStatus: getSelectedValue('residential-status'),
                        basicSalary: getInputValue('basic-salary'),
                        hraReceived: getInputValue('hra-received'),
                        rentPaid: getInputValue('rent-paid'),
                        metroCity: getSelectedValue('metro-city'),
                        otherAllowances: getInputValue('other-allowances'),
                        incomeOtherSources: getInputValue('income-other-sources'),
                        deduction80C: getInputValue('deduction-80c'),
                         deduction80D: getInputValue('deduction-80d'),
                         deduction80DParents: getInputValue('deduction-80d-parents'),
                         parentsSenior: getSelectedValue('parents-senior'),
                         homeLoanInterest: getInputValue('home-loan-interest'),
                        deduction80TTA: getInputValue('deduction-80tta'), // This input captures ACTUAL interest received
                         deductionNPS: getInputValue('deduction-nps')
                    };

                     // Use setTimeout to simulate processing and allow loader to display
                     setTimeout(() => {
                         const results = calculateTaxLiability(inputs);
                        updateUI(results);
                         showResultsLoader(false); // Hide loader after processing
                        // GSAP animation for result cards entry (Handled via CSS/GSAP timeline)
                        gsap.to('.result-card', { // Example GSAP trigger after data population
                             opacity: 1,
                             scale: 1,
                            duration: 0.6,
                            stagger: 0.2,
                            ease: 'back.out(1.4)'
                        });
                     }, 800); // Simulate calculation time

                 } else {
                     // Maybe add a general error message at the top
                 }
            });

            // Info Icon Tooltips (simple hover) - CSS handles most of it
            // JS could be used for more complex tooltips if needed

            // PDF Download Button
             downloadPdfBtn.addEventListener('click', generatePDF);

            // Monthly Breakdown Toggles
             monthlyToggles.forEach(toggle => {
                 toggle.addEventListener('click', () => {
                    const targetId = toggle.dataset.target;
                     const breakdownDiv = document.getElementById(targetId);
                    const icon = toggle.querySelector('i');
                    if (breakdownDiv) {
                         const isVisible = breakdownDiv.classList.toggle('visible');
                        // Animate icon rotation (Anim #47)
                        gsap.to(icon, { rotate: isVisible ? 180 : 0, duration: 0.3 });
                    }
                });
            });

             // Add input validation on blur/change (Optional for better UX)
             const numericInputs = taxForm.querySelectorAll('input[type="number"]');
             numericInputs.forEach(input => {
                 input.addEventListener('blur', () => {
                    if (input.value && parseFloat(input.value) < 0) {
                         // showInputError(input.id, `${input.previousElementSibling?.textContent || 'Value'} cannot be negative.`);
                        gsap.to(input, { x: "+=5", yoyo: true, repeat: 3, duration: 0.08, ease: "power1.inOut" }); // Shake effect (Anim #48)
                         input.value = 0; // Reset negative value
                     } else {
                         // clearInputError(input.id);
                     }
                     // Enforce max values if needed (e.g., for 80C)
                     if(input.max && input.value > parseFloat(input.max)) {
                         input.value = input.max;
                          // Add visual feedback (maybe tooltip)
                         gsap.to(input, { borderBottomColor: "var(--warning-color)", duration: 0.5, yoyo: true, repeat: 1 }); // Flash warning color (Anim #49)
                     }
                 });
             });

         };


        // Initialization
        // ==============================================================
         const init = () => {
             runInitialAnimations();
            setupEventListeners();

             // Set current AY in non-result places
             currentAyElements.forEach(el => el.textContent = CURRENT_AY);

            // Set default styles for charts globally (optional)
             Chart.defaults.color = var(--text-secondary); // Default font color
             Chart.defaults.borderColor = var(--border-color); // Default line/border colors
             Chart.defaults.font.family = var(--font-primary);
             Chart.defaults.plugins.tooltip.mode = 'index';
             Chart.defaults.plugins.tooltip.intersect = false;
             Chart.defaults.plugins.tooltip.padding = 10;
             Chart.defaults.plugins.tooltip.titleFont = { size: 14, weight: 'bold', family: var(--font-display) };
             Chart.defaults.plugins.tooltip.bodyFont = { size: 12 };


            console.log("TaxVerse AI Initialized (AY " + CURRENT_AY + ")");
            // More init logic if needed
         };

        // Run init function when DOM is fully loaded
         document.addEventListener('DOMContentLoaded', init);

    </script>
</body>
</html>
```